var request = require('request');

function Bot(key, mode, url) {
  this.key = key;
  this.mode = mode || 'training';
  this.serverURL = url === undefined ? 'http://vindinium.org' : url;
  this.URL = this.serverURL + '/api/' + this.mode;
}

Bot.prototype.run = function(cb) {
  request.post({url: this.URL, form: {key: this.key}}, function(err, res, body) {
    this.data = JSON.parse(body);
    this.playURL = this.data.playUrl;
    console.log('first run');
    cb(this.data);
  });
  if(this.data.finished !== true) {
    setInterval(function() {
      request.post({url: this.playURL, form: {key: this.key, dir: cb(this.data)}}, function(err, res, body) {
        console.log('run');
      });
    }, 500);
  }
};

Bot.prototype.helpers = {
  pathfinder: function() {
    // pathfinder code
  }
};

module.exports = Bot;
